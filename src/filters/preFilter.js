/**
 * AI ë¶„ì„ ì „ ì‚¬ì „ í•„í„°ë§
 * ì œëª© + ì„¤ëª…ì„ ë¶„ì„í•˜ì—¬ ê´‘ê³ ì„±/ë¬´ê´€ ê¸°ì‚¬ ì œê±°
 */

// ==================== ì œì™¸ íŒ¨í„´ (ëŒ€í­ í™•ì¥) ====================
const EXCLUDE_PATTERNS = [
    // ê´‘ê³ /í™ë³´
    /\[ê´‘ê³ \]/i, /\[AD\]/i, /\[PR\]/i, /\[í›„ì›\]/i, /\[í˜‘ì°¬\]/i,
    /\[ì œíœ´\]/i, /\[íŒŒíŠ¸ë„ˆ\]/i, /sponsored/i, /advertisement/i,
    /ë¸Œëœë””ë“œ/, /ë„¤ì´í‹°ë¸Œ ê´‘ê³ /, /ì œíœ´ì½˜í…ì¸ /,

    // ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜/ì‡¼í•‘
    /ì´ë²¤íŠ¸/, /ê²½í’ˆ/, /í• ì¸/, /ì¿ í°/, /ì„¸ì¼/, /íŠ¹ê°€/, /ë¬´ë£Œì²´í—˜/,
    /ì‘ëª¨/, /ë‹¹ì²¨/, /ì¶”ì²¨/, /ì¦ì •/, /ì‚¬ì€í’ˆ/, /í”„ë¡œëª¨ì…˜/,
    /ì‡¼í•‘/, /êµ¬ë§¤/, /ìµœì €ê°€/, /í•«ë”œ/, /íƒ€ì„ì„¸ì¼/,
    /ë¸”ë™í”„ë¼ì´ë°ì´/, /ì‚¬ì´ë²„ë¨¼ë°ì´/, /ë¹…ì„¸ì¼/,

    // ì—°ì˜ˆ/ì—”í„°í…Œì¸ë¨¼íŠ¸
    /ë“œë¼ë§ˆ/, /ì˜ˆëŠ¥/, /ì•„ì´ëŒ/, /ê±¸ê·¸ë£¹/, /ë³´ì´ê·¸ë£¹/, /ê°€ìˆ˜/,
    /ë°°ìš°/, /ì—°ê¸°/, /ì—°ì˜ˆì¸/, /ì…€ëŸ½/, /ìŠ¤íƒ€/, /íŒ¬ë¤/,
    /ì½˜ì„œíŠ¸/, /íŒ¬ë¯¸íŒ…/, /ì•¨ë²”/, /ìŒì›/, /ì°¨íŠ¸/, /ì»´ë°±/,
    /ë®¤ì§ë¹„ë””ì˜¤/, /ë®¤ë¹„/, /í‹°ì €/, /ê³µê°œë°©ì†¡/,
    /ì˜í™”/, /ê°œë´‰/, /ë°•ìŠ¤ì˜¤í”¼ìŠ¤/, /ê´€ê°ìˆ˜/,
    /ì›¹íˆ°/, /ì›¹ì†Œì„¤/, /ë§Œí™”/,

    // ìŠ¤í¬ì¸ 
    /ì¶•êµ¬/, /ì•¼êµ¬/, /ë†êµ¬/, /ë°°êµ¬/, /ê³¨í”„ëŒ€íšŒ/, /í…Œë‹ˆìŠ¤/,
    /ì˜¬ë¦¼í”½/, /ì›”ë“œì»µ/, /ë¦¬ê·¸/, /ê²½ê¸°ê²°ê³¼/, /ìŠ¹ë¦¬/, /íŒ¨ë°°/,
    /ì„ ìˆ˜/, /ê°ë…/, /ì½”ì¹˜/, /ì´ì /, /íŠ¸ë ˆì´ë“œ/,
    /eìŠ¤í¬ì¸ /, /ê²Œì„ëŒ€íšŒ/, /ë¡¤ë“œì»µ/, /LCK/,

    // ë¯¸ë””ì–´/í¬í† /ì˜ìƒ
    /í¬í† ë‰´ìŠ¤/, /í™”ë³´/, /ì›€ì§¤/, /ì§ìº /, /ì˜ìƒë‰´ìŠ¤/,
    /\[í¬í† \]/, /\[ì˜ìƒ\]/, /\[ì›€ì§¤\]/, /\[í™”ë³´\]/,
    /ì‚¬ì§„/, /ê°¤ëŸ¬ë¦¬/, /ë¹„í•˜ì¸ë“œ/, /ë©”ì´í‚¹/,

    // ë‚ ì”¨/ìš´ì„¸/ë¼ì´í”„
    /ì˜¤ëŠ˜ì˜ ìš´ì„¸/, /ì˜¤ëŠ˜ì˜ ë‚ ì”¨/, /ì£¼ê°„ ë‚ ì”¨/, /ì¼ê¸°ì˜ˆë³´/,
    /ë³„ìë¦¬/, /íƒ€ë¡œ/, /ì‚¬ì£¼/, /ê¶í•©/,
    /ë§›ì§‘/, /ë ˆì‹œí”¼/, /ìš”ë¦¬/, /ì¹´í˜/, /ë§›ì§‘ì¶”ì²œ/,
    /ì—¬í–‰/, /í˜¸í…”/, /ìˆ™ë°•/, /ê´€ê´‘/, /íœ´ê°€/,
    /íŒ¨ì…˜/, /ë·°í‹°/, /í™”ì¥í’ˆ/, /ë©”ì´í¬ì—…/, /í—¤ì–´/,
    /ë‹¤ì´ì–´íŠ¸/, /ìš´ë™/, /í—¬ìŠ¤/, /í”¼íŠ¸ë‹ˆìŠ¤/,

    // ë¶€ë™ì‚°/ê°œì¸ê¸ˆìœµ (ê¸°ì—… ë‰´ìŠ¤ ì•„ë‹Œ ê²ƒ)
    /ì•„íŒŒíŠ¸ ë¶„ì–‘/, /ì²­ì•½/, /ì „ì„¸/, /ì›”ì„¸/, /ë¶€ë™ì‚° ë§¤ë§¤/,
    /ëŒ€ì¶œ ê¸ˆë¦¬/, /ì˜ˆê¸ˆ ê¸ˆë¦¬/, /ì ê¸ˆ ì¶”ì²œ/, /ì €ì¶•/, /ì¬í…Œí¬/,
    /ì‹ ìš©ì¹´ë“œ/, /ì¹´ë“œ í˜œíƒ/, /í¬ì¸íŠ¸/, /ë§ˆì¼ë¦¬ì§€/,

    // ì •ì¹˜/ì‚¬íšŒ ì¼ë°˜
    /êµ­íšŒ/, /ì—¬ë‹¹/, /ì•¼ë‹¹/, /ëŒ€í†µë ¹/, /ì´ë¦¬/, /ì¥ê´€í›„ë³´/,
    /ì„ ê±°/, /íˆ¬í‘œ/, /ê³µì²œ/, /ì •ë‹¹/, /ë‹¹ëŒ€í‘œ/,
    /ì‚¬ê±´ì‚¬ê³ /, /ë²”ì£„/, /ê²€ì°°/, /ê²½ì°°/, /ì¬íŒ/, /íŒê²°/,
    /ì‹œìœ„/, /ì§‘íšŒ/, /ë†ì„±/, /íŒŒì—…/,

    // êµìœ¡/ì…ì‹œ
    /ìˆ˜ëŠ¥/, /ëŒ€ì…/, /ì…ì‹œ/, /í•™ì›/, /ê³¼ì™¸/, /í•™êµ/,
    /ëŒ€í•™/, /í•©ê²©/, /ë“±ë¡ê¸ˆ/, /ì¥í•™ê¸ˆ/,

    // ê±´ê°•/ì˜ë£Œ ì¼ë°˜
    /ê±´ê°•/, /ì§ˆë³‘/, /ì¹˜ë£Œ/, /ë³‘ì›/, /ì•½/, /ì²˜ë°©/,
    /ë‹¤ì´ì–´íŠ¸/, /ì‚´ë¹¼ê¸°/, /ì²´ì¤‘/, /ë¹„ë§Œ/,

    // ê¸°íƒ€ ë¬´ê´€
    /ì¸í„°ë·°/, /ì¹¼ëŸ¼/, /ì‚¬ì„¤/, /ê¸°ê³ /, /ë…ìíˆ¬ê³ /,
    /ë¶€ê³ /, /ì¡°ì˜/, /ë³„ì„¸/, /íƒ€ê³„/,
    /ë³µê¶Œ/, /ë¡œë˜/, /ë‹¹ì²¨ë²ˆí˜¸/
];

// ==================== ë¹„ì¦ˆë‹ˆìŠ¤ í•„ìˆ˜ í‚¤ì›Œë“œ (ëŒ€í­ í™•ì¥) ====================
const BUSINESS_KEYWORDS = [
    // === ì¬ë¬´/ì‹¤ì  ===
    'ì‹¤ì ', 'ë§¤ì¶œ', 'ì˜ì—…ì´ìµ', 'ìˆœì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ', 'ì˜ì—…ì†ì‹¤',
    'ë¶„ê¸°', 'ì—°ê°„', 'ì „ë…„ëŒ€ë¹„', 'ì „ë¶„ê¸°', 'í‘ì', 'ì ì', 'í˜¸ì‹¤ì ',
    'ì–´ë‹ì„œí”„ë¼ì´ì¦ˆ', 'ì–´ë‹ì‡¼í¬', 'ì»¨ì„¼ì„œìŠ¤', 'ì‹¤ì ë°œí‘œ', 'ì ì •ì‹¤ì ',

    // === ìˆ˜ì£¼/ê³„ì•½ ===
    'ìˆ˜ì£¼', 'ê³„ì•½', 'ë‚™ì°°', 'ê³µê¸‰ê³„ì•½', 'ë‚©í’ˆê³„ì•½', 'ë…ì ê³„ì•½',
    'í˜‘ì•½', 'MOU', 'íŒŒíŠ¸ë„ˆì‹­', 'ì œíœ´', 'í˜‘ë ¥', 'ì¡°ì¸íŠ¸ë²¤ì²˜',
    '1ì¡°', 'ì¡°ì›', 'ì–µì›', 'ëŒ€í˜•ê³„ì•½', 'ë©”ê°€ë”œ', 'ë¹…ë”œ',

    // === M&A/ì§€ë°°êµ¬ì¡° ===
    'ì¸ìˆ˜', 'í•©ë³‘', 'M&A', 'ë¶„í• ', 'ë¶„ì‚¬', 'ìíšŒì‚¬', 'ê³„ì—´ì‚¬',
    'ì§€ë¶„', 'ì§€ë¶„ë§¤ê°', 'ì§€ë¶„ì¸ìˆ˜', 'ê²½ì˜ê¶Œ', 'ìµœëŒ€ì£¼ì£¼',
    'ìƒì¥', 'IPO', 'ìŠ¤íŒ©', 'ìƒì¥íì§€', 'ì¬ìƒì¥',

    // === íˆ¬ì/ìê¸ˆ ===
    'íˆ¬ì', 'ì¦ì', 'ìœ ìƒì¦ì', 'ë¬´ìƒì¦ì', 'CB', 'BW', 'ì „í™˜ì‚¬ì±„',
    'ë°°ë‹¹', 'ë°°ë‹¹ê¸ˆ', 'ìì‚¬ì£¼', 'ìì‚¬ì£¼ë§¤ì…', 'ì£¼ì£¼í™˜ì›',
    'í€ë”©', 'íˆ¬ììœ ì¹˜', 'ì‹œë¦¬ì¦ˆA', 'ì‹œë¦¬ì¦ˆB', 'ì‹œë¦¬ì¦ˆC',

    // === ì£¼ê°€/ì‹œì¥ ===
    'ì£¼ê°€', 'ì‹œê°€ì´ì•¡', '52ì£¼ ì‹ ê³ ê°€', '52ì£¼ ì‹ ì €ê°€', 'ê¸‰ë“±', 'ê¸‰ë½',
    'ìƒí•œê°€', 'í•˜í•œê°€', 'ê±°ë˜ëŸ‰', 'ì™¸êµ­ì¸', 'ê¸°ê´€', 'ê°œì¸íˆ¬ìì',

    // === ì‚¬ì—…/ì œí’ˆ ===
    'ì‹ ì‚¬ì—…', 'ì‹ ì œí’ˆ', 'ì¶œì‹œ', 'ê°œë°œ', 'ìƒì‚°', 'ì–‘ì‚°', 'ìƒìš©í™”',
    'ê³µì¥', 'ì„¤ë¹„', 'ì¦ì„¤', 'ë¼ì¸', 'ìƒì‚°ëŠ¥ë ¥', 'ìºíŒŒ', 'CAPA',
    'ìˆ˜ì¶œ', 'ìˆ˜ì…', 'íŒë§¤', 'ë‚©í’ˆ', 'ê³µê¸‰', 'ë¬¼ëŸ‰',

    // === ì¸ì‚¬/ì¡°ì§ ===
    'ëŒ€í‘œì´ì‚¬', 'CEO', 'ì‚¬ì¥', 'íšŒì¥', 'ë¶€íšŒì¥', 'ë¶€ì‚¬ì¥', 'ì „ë¬´', 'ìƒë¬´',
    'ì„ì›', 'ì¸ì‚¬', 'ì¡°ì§ê°œí¸', 'êµ¬ì¡°ì¡°ì •', 'í¬ë§í‡´ì§', 'ì¸ë ¥êµ¬ì¡°ì¡°ì •',
    'ì±„ìš©', 'ì¸ë ¥', 'ê³µì±„', 'ê²½ë ¥ì±„ìš©', 'ëŒ€ê·œëª¨ì±„ìš©',

    // === ê¸°ìˆ /R&D ===
    'ê¸°ìˆ ', 'íŠ¹í—ˆ', 'ì—°êµ¬', 'R&D', 'í˜ì‹ ', 'ê°œë°œ', 'ì—°êµ¬ì†Œ',
    'AI', 'ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'GPT', 'LLM',
    'ììœ¨ì£¼í–‰', 'ì „ê¸°ì°¨', 'EV', 'ë°°í„°ë¦¬', '2ì°¨ì „ì§€', 'ì „ê³ ì²´',
    'ë°˜ë„ì²´', 'íŒŒìš´ë“œë¦¬', 'ë©”ëª¨ë¦¬', 'HBM', 'DRAM', 'NAND',
    '5G', '6G', 'í†µì‹ ', 'ë„¤íŠ¸ì›Œí¬', 'í´ë¼ìš°ë“œ', 'ë°ì´í„°ì„¼í„°',
    'ë¡œë´‡', 'ë“œë¡ ', 'ìš°ì£¼', 'ìœ„ì„±', 'ë°œì‚¬',

    // === ì‚°ì—…/ì‹œì¥ ===
    'ì‹œì¥', 'ì ìœ ìœ¨', 'ê²½ìŸ', 'ì—…ê³„', 'ì‚°ì—…', 'ì„¹í„°',
    'ì „ë§', 'ë¶„ì„', 'ë¦¬í¬íŠ¸', 'ë³´ê³ ì„œ', 'ì „ëµ', 'ëª©í‘œê°€',
    '1ìœ„', '2ìœ„', '3ìœ„', 'ì„ ë‘', 'í›„ë°œ', 'ì¶”ê²©',

    // === ê¸€ë¡œë²Œ ===
    'í•´ì™¸ì§„ì¶œ', 'ìˆ˜ì¶œ', 'ê¸€ë¡œë²Œ', 'ë¶ë¯¸', 'ìœ ëŸ½', 'ì¤‘êµ­', 'ì¼ë³¸',
    'í˜„ì§€ë²•ì¸', 'í•´ì™¸ë²•ì¸', 'ê¸€ë¡œë²Œì‹œì¥', 'ì„¸ê³„ì‹œì¥',

    // === ê·œì œ/ì •ì±… ===
    'ê·œì œ', 'ì •ì±…', 'ë²•ì•ˆ', 'ê°œì •', 'ì‹œí–‰', 'ì¸í—ˆê°€', 'ìŠ¹ì¸',
    'ê´€ì„¸', 'ë°˜ë¤í•‘', 'ë¬´ì—­', 'IRA', 'CHIPS', 'ë³´ì¡°ê¸ˆ',

    // === ì˜ë¬¸ í‚¤ì›Œë“œ ===
    'revenue', 'profit', 'earnings', 'quarterly', 'annual',
    'acquisition', 'merger', 'partnership', 'investment',
    'launch', 'release', 'develop', 'expand', 'growth'
];

/**
 * ê´‘ê³ ì„±/ë¬´ê´€ íŒ¨í„´ ì²´í¬
 */
function hasExcludePattern(text) {
    return EXCLUDE_PATTERNS.some(pattern => pattern.test(text));
}

/**
 * ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ë ¨ í‚¤ì›Œë“œ ì²´í¬
 */
function hasBusinessKeyword(text) {
    const lowerText = text.toLowerCase();
    return BUSINESS_KEYWORDS.some(keyword =>
        lowerText.includes(keyword.toLowerCase())
    );
}

/**
 * ì„¤ëª…ë¬¸ í’ˆì§ˆ ì²´í¬
 */
function hasQualityDescription(description) {
    if (!description) return false;
    if (description.length < 50) return false;

    const sentences = description.split(/[.!?]/);
    const validSentences = sentences.filter(s => s.trim().length > 20);

    return validSentences.length >= 1;
}

/**
 * ì‚¬ì „ í•„í„°ë§ ë©”ì¸ í•¨ìˆ˜
 */
export function preFilterNews(newsItems) {
    const passed = [];
    const excluded = {
        adPattern: 0,
        noBusinessKeyword: 0,
        lowQuality: 0
    };

    for (const item of newsItems) {
        const fullText = `${item.title} ${item.description || ''}`;

        // 1. ê´‘ê³ ì„± íŒ¨í„´ ì²´í¬
        if (hasExcludePattern(fullText)) {
            excluded.adPattern++;
            continue;
        }

        // 2. ê¸€ë¡œë²Œ ë‰´ìŠ¤ëŠ” ì´ë¯¸ ê¸°ì—…ëª…ìœ¼ë¡œ ê²€ìƒ‰ë¨ â†’ ë°”ë¡œ í†µê³¼
        if (item.isGlobal) {
            passed.push(item);
            continue;
        }

        // 3. ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ì›Œë“œ ì²´í¬ (ì œëª© ë˜ëŠ” ì„¤ëª…ì— í¬í•¨)
        const hasBusinessContent = hasBusinessKeyword(fullText);

        // 4. ê¸°ì—…ëª…ì´ ì´ë¯¸ ë§¤ì¹­ëœ ê²½ìš° ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ì›Œë“œ ì—†ì–´ë„ í†µê³¼
        const hasCompany = item.companies && item.companies.length > 0;

        if (!hasBusinessContent && !hasCompany) {
            excluded.noBusinessKeyword++;
            continue;
        }

        // 5. ì„¤ëª…ë¬¸ í’ˆì§ˆ ì²´í¬ (ìˆëŠ” ê²½ìš°ë§Œ)
        if (item.description && !hasQualityDescription(item.description)) {
            if (hasCompany && hasBusinessKeyword(item.title)) {
                passed.push(item);
                continue;
            }
            excluded.lowQuality++;
            continue;
        }

        passed.push(item);
    }

    const globalCount = passed.filter(n => n.isGlobal).length;
    const domesticCount = passed.length - globalCount;

    console.log(`ğŸ¯ [ì‚¬ì „ í•„í„°] ${newsItems.length}ê°œ â†’ ${passed.length}ê°œ í†µê³¼`);
    console.log(`   â”œâ”€ ê´‘ê³ /ë¬´ê´€ ì œì™¸: ${excluded.adPattern}ê°œ`);
    console.log(`   â”œâ”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¬´ê´€: ${excluded.noBusinessKeyword}ê°œ`);
    console.log(`   â”œâ”€ ì €í’ˆì§ˆ: ${excluded.lowQuality}ê°œ`);
    console.log(`   â””â”€ í†µê³¼ (êµ­ë‚´: ${domesticCount}, í•´ì™¸: ${globalCount})`);

    return passed;
}

export default { preFilterNews };
