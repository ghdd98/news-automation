/**
 * AI ë¶„ì„ ì „ ì‚¬ì „ í•„í„°ë§
 * 1. ê´‘ê³ /ë¬´ê´€ íŒ¨í„´ ì œì™¸
 * 2. ìš°ì„ ìˆœìœ„ í‚¤ì›Œë“œ ì²´í¬
 * 3. ì£¼ìš” ì–¸ë¡ ì‚¬ ìš°ì„ 
 */

// ==================== ì œì™¸ íŒ¨í„´ ====================
const EXCLUDE_PATTERNS = [
    // ê´‘ê³ /í™ë³´
    /\[ê´‘ê³ \]/i, /\[AD\]/i, /\[PR\]/i, /\[í›„ì›\]/i, /\[í˜‘ì°¬\]/i,
    /\[ì œíœ´\]/i, /\[íŒŒíŠ¸ë„ˆ\]/i, /sponsored/i, /advertisement/i,
    /ë¸Œëžœë””ë“œ/, /ë„¤ì´í‹°ë¸Œ ê´‘ê³ /, /ì œíœ´ì½˜í…ì¸ /,

    // ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜/ì‡¼í•‘
    /ì´ë²¤íŠ¸ ì°¸ì—¬/, /ê²½í’ˆ ì‘ëª¨/, /í• ì¸ ì¿ í°/, /ì„¸ì¼ ê¸°ê°„/, /íŠ¹ê°€ í–‰ì‚¬/, /ë¬´ë£Œì²´í—˜/,
    /ì‘ëª¨í•˜/, /ë‹¹ì²¨ìž/, /ì¶”ì²¨/, /ì¦ì •/, /ì‚¬ì€í’ˆ/, /í”„ë¡œëª¨ì…˜ í–‰ì‚¬/,
    /ì‡¼í•‘ëª°/, /ìµœì €ê°€ êµ¬ë§¤/, /í•«ë”œ/, /íƒ€ìž„ì„¸ì¼/,
    /ë¸”ëž™í”„ë¼ì´ë°ì´/, /ì‚¬ì´ë²„ë¨¼ë°ì´/, /ë¹…ì„¸ì¼/,

    // ì—°ì˜ˆ/ì—”í„°í…Œì¸ë¨¼íŠ¸
    /ë“œë¼ë§ˆ ì¶œì—°/, /ì˜ˆëŠ¥ í”„ë¡œê·¸ëž¨/, /ì•„ì´ëŒ ê·¸ë£¹/, /ê±¸ê·¸ë£¹/, /ë³´ì´ê·¸ë£¹/, /ê°€ìˆ˜ í™œë™/,
    /ë°°ìš° ì¶œì—°/, /ì—°ê¸°ìž/, /ì—°ê¸°ë ¥/, /ì—°ê¸° í™œë™/, /ì—°ì˜ˆì¸/, /ì…€ëŸ½/, /ìŠ¤íƒ€ í™”ë³´/, /íŒ¬ë¤/,
    /ì½˜ì„œíŠ¸ ê°œìµœ/, /íŒ¬ë¯¸íŒ…/, /ì•¨ë²” ë°œë§¤/, /ìŒì› ì°¨íŠ¸/, /ì»´ë°± ë¬´ëŒ€/,
    /ë®¤ì§ë¹„ë””ì˜¤/, /ë®¤ë¹„ ê³µê°œ/, /í‹°ì € ì˜ìƒ/, /ê³µê°œë°©ì†¡/,
    /ì˜í™” ê°œë´‰/, /ë°•ìŠ¤ì˜¤í”¼ìŠ¤/, /ê´€ê°ìˆ˜ ëŒíŒŒ/,
    /ì›¹íˆ° ì—°ìž¬/, /ì›¹ì†Œì„¤/, /ë§Œí™”ì±…/,

    // ìŠ¤í¬ì¸ 
    /ì¶•êµ¬ ê²½ê¸°/, /ì•¼êµ¬ ê²½ê¸°/, /ë†êµ¬ ê²½ê¸°/, /ë°°êµ¬ ê²½ê¸°/, /ê³¨í”„ëŒ€íšŒ/, /í…Œë‹ˆìŠ¤ ëŒ€íšŒ/,
    /ì˜¬ë¦¼í”½ ì¶œì „/, /ì›”ë“œì»µ/, /í”„ë¡œë¦¬ê·¸/, /ê²½ê¸° ê²°ê³¼/, /ìŠ¹ë¦¬ë¥¼ ê±°/, /íŒ¨ë°°ë¥¼ ë‹¹/,
    /ìŠ¤í¬ì¸  ì„ ìˆ˜/, /ì•¼êµ¬ ì„ ìˆ˜/, /ì¶•êµ¬ ì„ ìˆ˜/, /ê°ë… ì„ ìž„/, /ì½”ì¹˜ ì˜ìž…/, /ì„ ìˆ˜ ì´ì /, /íŠ¸ë ˆì´ë“œ/,
    /eìŠ¤í¬ì¸  ëŒ€íšŒ/, /ê²Œìž„ëŒ€íšŒ/, /ë¡¤ë“œì»µ/, /LCK ê²°ìŠ¹/,

    // ë¯¸ë””ì–´/í¬í† /ì˜ìƒ
    /í¬í† ë‰´ìŠ¤/, /í™”ë³´ ì´¬ì˜/, /ì›€ì§¤/, /ì§ìº  ì˜ìƒ/, /ì˜ìƒë‰´ìŠ¤/,
    /\[í¬í† \]/, /\[ì˜ìƒ\]/, /\[ì›€ì§¤\]/, /\[í™”ë³´\]/,
    /í¬í†  ê°¤ëŸ¬ë¦¬/, /ë¹„í•˜ì¸ë“œ ì»·/, /ë©”ì´í‚¹ í•„ë¦„/,

    // ë‚ ì”¨/ìš´ì„¸/ë¼ì´í”„
    /ì˜¤ëŠ˜ì˜ ìš´ì„¸/, /ì˜¤ëŠ˜ì˜ ë‚ ì”¨/, /ì£¼ê°„ ë‚ ì”¨/, /ì¼ê¸°ì˜ˆë³´/,
    /ë³„ìžë¦¬ ìš´ì„¸/, /íƒ€ë¡œ ì /, /ì‚¬ì£¼íŒ”ìž/, /ê¶í•© ë³´ê¸°/,
    /ë§›ì§‘ ì¶”ì²œ/, /ë ˆì‹œí”¼ ê³µê°œ/, /ìš”ë¦¬ ë°©ë²•/, /ì¹´íŽ˜ ì¶”ì²œ/, /ë§›ì§‘íƒë°©/,
    /ì—¬í–‰ì§€ ì¶”ì²œ/, /í˜¸í…” ì˜ˆì•½/, /ìˆ™ë°• í• ì¸/, /ê´€ê´‘ ëª…ì†Œ/, /íœ´ê°€ ê³„íš/,
    /íŒ¨ì…˜ ìŠ¤íƒ€ì¼/, /ë·°í‹° íŒ/, /í™”ìž¥í’ˆ ì¶”ì²œ/, /ë©”ì´í¬ì—… íŠœí† ë¦¬ì–¼/, /í—¤ì–´ ìŠ¤íƒ€ì¼/,
    /ë‹¤ì´ì–´íŠ¸ ë°©ë²•/, /í”¼íŠ¸ë‹ˆìŠ¤ íŒ/,

    // ë¶€ë™ì‚°/ê°œì¸ê¸ˆìœµ
    /ì•„íŒŒíŠ¸ ë¶„ì–‘/, /ì²­ì•½ ì¼ì •/, /ì „ì„¸ ì‹œì„¸/, /ì›”ì„¸ ê°€ê²©/, /ë¶€ë™ì‚° ë§¤ë§¤/,
    /ëŒ€ì¶œ ê¸ˆë¦¬ ë¹„êµ/, /ì˜ˆê¸ˆ ê¸ˆë¦¬/, /ì ê¸ˆ ì¶”ì²œ/, /ê°œì¸ ìž¬í…Œí¬/,
    /ì‹ ìš©ì¹´ë“œ ì¶”ì²œ/, /ì¹´ë“œ í˜œíƒ/, /í¬ì¸íŠ¸ ì ë¦½/, /ë§ˆì¼ë¦¬ì§€ ì‚¬ìš©/,

    // ì •ì¹˜/ì‚¬íšŒ ì¼ë°˜
    /êµ­íšŒ ë³¸íšŒì˜/, /ì—¬ë‹¹ ì˜ì›/, /ì•¼ë‹¹ ëŒ€í‘œ/, /ëŒ€í†µë ¹ ë°œì–¸/, /ì´ë¦¬ í›„ë³´/, /ìž¥ê´€í›„ë³´ìž/,
    /ì„ ê±° ìœ ì„¸/, /íˆ¬í‘œ ê²°ê³¼/, /ê³µì²œ ê²½ìŸ/, /ì •ë‹¹ í™œë™/, /ë‹¹ëŒ€í‘œ ì„ ì¶œ/,
    /ì‚¬ê±´ì‚¬ê³  í˜„ìž¥/, /ë²”ì£„ ìˆ˜ì‚¬/, /ê²€ì°° ê¸°ì†Œ/, /ê²½ì°° ì¡°ì‚¬/, /ìž¬íŒ ê²°ê³¼/, /ë²•ì› íŒê²°/,
    /ì‹œìœ„ í˜„ìž¥/, /ì§‘íšŒ ì°¸ê°€/, /ë†ì„± ëŒìž…/, /íŒŒì—… ëŒìž…/,

    // êµìœ¡/ìž…ì‹œ
    /ìˆ˜ëŠ¥ ì‹œí—˜/, /ëŒ€ìž… ì „í˜•/, /ìž…ì‹œ ì„¤ëª…íšŒ/, /í•™ì› ìˆ˜ê°•/, /ê³¼ì™¸ ëª¨ì§‘/,
    /ëŒ€í•™ í•©ê²©/, /ë“±ë¡ê¸ˆ ì¸ìƒ/, /ìž¥í•™ê¸ˆ ìˆ˜í˜œ/,

    // ê±´ê°•/ì˜ë£Œ ì¼ë°˜
    /ê±´ê°• ê´€ë¦¬ íŒ/, /ì§ˆë³‘ ì˜ˆë°©/, /ì¹˜ë£Œ ë°©ë²•/, /ë³‘ì› ì§„ë£Œ/, /ì²˜ë°©ì „/,
    /ë‹¤ì´ì–´íŠ¸ ì‹ë‹¨/, /ì‚´ë¹¼ê¸° ë¹„ë²•/, /ì²´ì¤‘ ê°ëŸ‰/, /ë¹„ë§Œ ê´€ë¦¬/,

    // ê¸°íƒ€ ë¬´ê´€
    /ë‹¨ë… ì¸í„°ë·°/, /ì¹¼ëŸ¼ë‹ˆìŠ¤íŠ¸/, /ì‚¬ì„¤/, /ê¸°ê³ ë¬¸/, /ë…ìžíˆ¬ê³ /,
    /ë¶€ê³  ì†Œì‹/, /ì¡°ì˜/, /ë³„ì„¸ ì†Œì‹/, /íƒ€ê³„í•˜/,
    /ë³µê¶Œ ë‹¹ì²¨/, /ë¡œë˜ ë²ˆí˜¸/, /ë‹¹ì²¨ë²ˆí˜¸ ê³µê°œ/
];

// ==================== ìš°ì„ ìˆœìœ„ í‚¤ì›Œë“œ (ëŒ€í­ í™•ìž¥) ====================
const PRIORITY_KEYWORDS = [
    // === ë¹„ì¦ˆë‹ˆìŠ¤ í™œë™ ===
    'ìˆ˜ì£¼', 'ê³„ì•½', 'MOU', 'í˜‘ì•½', 'íŒŒíŠ¸ë„ˆì‹­', 'ì œíœ´', 'ê³µê¸‰ê³„ì•½', 'ë‚©í’ˆ', 'ì¡°ë‹¬',
    'ë‚™ì°°', 'ìž…ì°°', 'ë°œì£¼', 'ë…ì ê³„ì•½', 'ë¼ì´ì„ ìŠ¤', 'ê¸°ìˆ ì´ì „',

    // === ìž¬ë¬´/ì‹¤ì  ===
    'ì‹¤ì ', 'ë§¤ì¶œ', 'ì˜ì—…ì´ìµ', 'ìˆœì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ', 'ì˜ì—…ì†ì‹¤', 'ì ìžì „í™˜', 'í‘ìžì „í™˜',
    'ë¶„ê¸°', 'ì—°ê°„', 'ë°˜ê¸°', 'ìž ì •ì‹¤ì ', 'ì‹¤ì ë°œí‘œ', 'ì–´ë‹', 'ì»¨ì„¼ì„œìŠ¤',
    'ì¡°ì›', 'ì–µì›', 'ì „ë…„ëŒ€ë¹„', 'ì „ë¶„ê¸°', 'ì„±ìž¥', 'ì¦ê°€', 'ê°ì†Œ', 'í˜¸ì‹¤ì ',
    'ë§¤ì¶œì•¡', 'ì´ìµë¥ ', 'ìˆ˜ìµì„±', 'ì›ê°€', 'ë¹„ìš©ì ˆê°',

    // === M&A/ì§€ë°°êµ¬ì¡°/íˆ¬ìž ===
    'ì¸ìˆ˜', 'í•©ë³‘', 'M&A', 'ë¶„í• ', 'ë¶„ì‚¬', 'ë¬¼ì ë¶„í• ', 'ì¸ì ë¶„í• ',
    'íˆ¬ìž', 'íˆ¬ìžìœ ì¹˜', 'íŽ€ë”©', 'ì‹œë¦¬ì¦ˆA', 'ì‹œë¦¬ì¦ˆB', 'ì‹œë¦¬ì¦ˆC', 'VC', 'ë²¤ì²˜íˆ¬ìž',
    'IPO', 'ìƒìž¥', 'ìŠ¤íŒ©', 'ìƒìž¥íì§€', 'ìž¬ìƒìž¥', 'ê³µëª¨', 'ì²­ì•½',
    'ì§€ë¶„', 'ì§€ë¶„ë§¤ê°', 'ì§€ë¶„ì¸ìˆ˜', 'ê²½ì˜ê¶Œ', 'ìµœëŒ€ì£¼ì£¼', 'ëŒ€ì£¼ì£¼',
    'ì¦ìž', 'ìœ ìƒì¦ìž', 'ë¬´ìƒì¦ìž', 'ì „í™˜ì‚¬ì±„', 'CB', 'BW',
    'ë°°ë‹¹', 'ë°°ë‹¹ê¸ˆ', 'ìžì‚¬ì£¼', 'ìžì‚¬ì£¼ë§¤ìž…', 'ì£¼ì£¼í™˜ì›',

    // === ì£¼ê°€/ì‹œí™© ===
    'ì£¼ê°€', 'ì‹œê°€ì´ì•¡', 'ê¸‰ë“±', 'ê¸‰ë½', 'ìƒí•œê°€', 'í•˜í•œê°€', '52ì£¼ ì‹ ê³ ê°€', '52ì£¼ ì‹ ì €ê°€',
    'ëª©í‘œê°€', 'íˆ¬ìžì˜ê²¬', 'ë§¤ìˆ˜', 'ë§¤ë„', 'ì¤‘ë¦½', 'ìƒí–¥', 'í•˜í–¥',

    // === ì œí’ˆ/ê¸°ìˆ /ìƒì‚° ===
    'ì‹ ì œí’ˆ', 'ì¶œì‹œ', 'ê³µê°œ', 'ë°œí‘œ', 'ë¡ ì¹­', 'í”„ë¦¬ì˜¤ë”',
    'ê°œë°œ', 'ê°œë°œì™„ë£Œ', 'ìƒìš©í™”', 'ì–‘ì‚°', 'ì–‘ì‚°ê°œì‹œ', 'ìƒì‚°', 'ìƒì‚°ëŠ¥ë ¥',
    'ê³µìž¥', 'ì¦ì„¤', 'ì„¤ë¹„', 'ì‹ ê³µìž¥', 'ë¼ì¸', 'ìºíŒŒ', 'CAPA', 'ê°€ë™ë¥ ',
    'ê¸°ìˆ ', 'íŠ¹í—ˆ', 'R&D', 'ì—°êµ¬', 'ì—°êµ¬ì†Œ', 'í˜ì‹ ', 'í•µì‹¬ê¸°ìˆ ',
    'ì‹œì œí’ˆ', 'í”„ë¡œí† íƒ€ìž…', 'í…ŒìŠ¤íŠ¸', 'ê²€ì¦', 'ì¸ì¦',

    // === ì¡°ì§/ì¸ì‚¬ ===
    'CEO', 'ëŒ€í‘œì´ì‚¬', 'ì‚¬ìž¥', 'íšŒìž¥', 'ë¶€íšŒìž¥', 'ë¶€ì‚¬ìž¥', 'ì „ë¬´', 'ìƒë¬´',
    'ìž„ì›', 'ì´ì‚¬', 'ì‚¬ì™¸ì´ì‚¬', 'ê°ì‚¬',
    'ì¸ì‚¬', 'ìŠ¹ì§„', 'ì„ ìž„', 'ì·¨ìž„', 'ì‚¬ìž„', 'êµì²´',
    'ì¡°ì§ê°œíŽ¸', 'êµ¬ì¡°ì¡°ì •', 'í¬ë§í‡´ì§', 'ì¸ë ¥ê°ì¶•', 'í†µí•©',
    'ì±„ìš©', 'ê³µì±„', 'ê²½ë ¥ì±„ìš©', 'ëŒ€ê·œëª¨ì±„ìš©', 'ì¸ë ¥',

    // === í•´ì™¸/ìˆ˜ì¶œ/ê¸€ë¡œë²Œ ===
    'ìˆ˜ì¶œ', 'ìˆ˜ìž…', 'ìˆ˜ì¶œê³„ì•½', 'í•´ì™¸ìˆ˜ì£¼', 'í•´ì™¸ì§„ì¶œ', 'ê¸€ë¡œë²Œ',
    'ë¶ë¯¸', 'ë¯¸êµ­', 'ìœ ëŸ½', 'ì¤‘êµ­', 'ì¼ë³¸', 'ë™ë‚¨ì•„', 'ì¸ë„',
    'í˜„ì§€ë²•ì¸', 'í•´ì™¸ë²•ì¸', 'í•´ì™¸ê³µìž¥', 'ê¸€ë¡œë²Œì‹œìž¥',

    // === ê·œì œ/ì •ì±…/ì¸í—ˆê°€ ===
    'ê·œì œ', 'ì •ì±…', 'ë²•ì•ˆ', 'ê°œì •', 'ì‹œí–‰', 'ì¸í—ˆê°€', 'ìŠ¹ì¸', 'í—ˆê°€',
    'ê´€ì„¸', 'ë°˜ë¤í•‘', 'ë¬´ì—­', 'IRA', 'CHIPS', 'ë³´ì¡°ê¸ˆ',
    'ì¸ì¦', 'ISO', 'CE', 'FDA', 'FCC',

    // === ìžë™ì°¨/ëª¨ë¹Œë¦¬í‹° ===
    'ì „ê¸°ì°¨', 'EV', 'í•˜ì´ë¸Œë¦¬ë“œ', 'ìˆ˜ì†Œì°¨', 'FCEV', 'ìžìœ¨ì£¼í–‰', 'ì™„ì„±ì°¨',
    'ë°°í„°ë¦¬', 'ì´ì°¨ì „ì§€', '2ì°¨ì „ì§€', 'ì „ê³ ì²´', 'ë¦¬íŠ¬', 'ì–‘ê·¹ìž¬', 'ìŒê·¹ìž¬',
    'ì¶©ì „', 'ì¶©ì „ì†Œ', 'ì¶©ì „ì¸í”„ë¼', 'V2G',

    // === ë°˜ë„ì²´/ì „ìž ===
    'ë°˜ë„ì²´', 'HBM', 'DRAM', 'NAND', 'ë©”ëª¨ë¦¬', 'íŒŒìš´ë“œë¦¬', 'ì‹œìŠ¤í…œë°˜ë„ì²´',
    'AIì¹©', 'GPU', 'CPU', 'AP', 'NPU', 'ê°€ì†ê¸°',
    'EUV', 'ë…¸ê´‘', 'íŒ¨í‚¤ì§•', 'ì›¨ì´í¼', 'íŒ¹', 'íŒ¹ë¦¬ìŠ¤',

    // === ì¡°ì„ /í•´ì–‘ ===
    'LNGì„ ', 'LNGC', 'ì»¨í…Œì´ë„ˆì„ ', 'ìœ ì¡°ì„ ', 'VLCC', 'ë²Œí¬ì„ ',
    'í•´ì–‘í”ŒëžœíŠ¸', 'FPSO', 'ë“œë¦´ì‹­', 'ìž ìˆ˜í•¨',
    'ì¹œí™˜ê²½ì„ ë°•', 'ì•”ëª¨ë‹ˆì•„ì„ ', 'ë©”íƒ„ì˜¬ì„ ', 'íƒˆíƒ„ì†Œ',

    // === ë°©ì‚°/í•­ê³µìš°ì£¼ ===
    'ë°©ì‚°', 'Kë°©ì‚°', 'ë°©ìœ„ì‚°ì—…', 'êµ­ë°©', 'ë¬´ê¸°', 'ìˆ˜ì¶œ',
    'ì „íˆ¬ê¸°', 'KF-21', 'F-35', 'ë¯¸ì‚¬ì¼', 'ì²œë¬´', 'í˜„ë¬´',
    'ìœ„ì„±', 'ìš°ì£¼', 'ë°œì‚¬', 'ë¡œì¼“',

    // === IT/AI/ì†Œí”„íŠ¸ì›¨ì–´ ===
    'AI', 'ì¸ê³µì§€ëŠ¥', 'LLM', 'ìƒì„±í˜•AI', 'GPT', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹',
    'í´ë¼ìš°ë“œ', 'SaaS', 'PaaS', 'ë°ì´í„°ì„¼í„°', 'IDC',
    'í”Œëž«í¼', 'ë””ì§€í„¸ì „í™˜', 'DX',

    // === ì—ë„ˆì§€/ì‹ ìž¬ìƒ ===
    'íƒœì–‘ê´‘', 'í’ë ¥', 'ì‹ ìž¬ìƒ', 'ESS', 'ì—ë„ˆì§€ì €ìž¥',
    'ìˆ˜ì†Œ', 'ìˆ˜ì†Œê²½ì œ', 'ê·¸ë¦°ìˆ˜ì†Œ', 'ë¸”ë£¨ìˆ˜ì†Œ',
    'ì›ì „', 'ì›ìžë ¥', 'SMR', 'ì†Œí˜•ëª¨ë“ˆì›ì „'
];

// ==================== ì£¼ìš” ê²½ì œ ì–¸ë¡ ì‚¬ ë° í†µì‹ ì‚¬ ====================
const MAJOR_SOURCES = [
    // 1ìˆœìœ„ - ì£¼ìš” ê²½ì œì§€
    'hankyung.com', 'í•œêµ­ê²½ì œ', 'í•œê²½',
    'mk.co.kr', 'ë§¤ì¼ê²½ì œ', 'ë§¤ê²½',
    'sedaily.com', 'ì„œìš¸ê²½ì œ',
    'yonhapnews', 'yna.co.kr', 'ì—°í•©ë‰´ìŠ¤',

    // 2ìˆœìœ„ - IT/ì‚°ì—… ì „ë¬¸
    'etnews.com', 'ì „ìžì‹ ë¬¸',
    'thelec.kr', 'ë”ì¼ë ‰',
    'theelec.kr',
    'mt.co.kr', 'ë¨¸ë‹ˆíˆ¬ë°ì´',
    'asiae.co.kr', 'ì•„ì‹œì•„ê²½ì œ',
    'biz.chosun.com', 'ì¡°ì„ ë¹„ì¦ˆ',

    // 3ìˆœìœ„ - ì£¼ìš” ì¼ê°„ì§€ ë° í†µì‹ ì‚¬
    'chosun.com', 'ì¡°ì„ ì¼ë³´',
    'donga.com', 'ë™ì•„ì¼ë³´',
    'joongang.co.kr', 'ì¤‘ì•™ì¼ë³´',
    'hani.co.kr', 'í•œê²¨ë ˆ',
    'khan.co.kr', 'ê²½í–¥ì‹ ë¬¸',
    'news1.kr', 'ë‰´ìŠ¤1',
    'newsis.com', 'ë‰´ì‹œìŠ¤'
];

// ==================== í•´ì™¸ ì£¼ìš” ì–¸ë¡ ì‚¬ (ê¸€ë¡œë²Œ) ====================
const MAJOR_GLOBAL_SOURCES = [
    // Finance & Biz
    'Bloomberg', 'Reuters', 'Wall Street Journal', 'WSJ',
    'Financial Times', 'FT.com', 'CNBC', 'Forbes', 'Fortune',
    'Business Insider', 'MarketWatch', 'Barron', 'Investopedia',
    'The Economist', 'Yahoo Finance',

    // Tech
    'TechCrunch', 'The Verge', 'Wired', 'VentureBeat',
    'Engadget', 'CNET', 'ZDNet', 'Ars Technica',
    'Tom\'s Hardware', 'AnandTech',

    // General Major
    'New York Times', 'NYT', 'Washington Post', 'BBC', 'CNN',
    'Guardian', 'Associated Press', 'AP News'
];

/**
 * ì œì™¸ íŒ¨í„´ ì²´í¬
 */
function hasExcludePattern(text) {
    return EXCLUDE_PATTERNS.some(pattern => pattern.test(text));
}

/**
 * ìš°ì„ ìˆœìœ„ í‚¤ì›Œë“œ ì²´í¬
 */
function hasPriorityKeyword(text) {
    const lowerText = text.toLowerCase();
    for (const keyword of PRIORITY_KEYWORDS) {
        if (lowerText.includes(keyword.toLowerCase())) {
            return keyword;
        }
    }
    return null;
}

/**
 * ì£¼ìš” ì–¸ë¡ ì‚¬ ì²´í¬ (êµ­ë‚´/í•´ì™¸ í†µí•©)
 */
function isMajorSource(item) {
    const link = item.link || '';
    const publisher = item.publisher || '';
    const lowerLink = link.toLowerCase();
    const lowerPublisher = publisher.toLowerCase();

    // 1. ê¸€ë¡œë²Œ ë‰´ìŠ¤ì¸ ê²½ìš°: í•´ì™¸ ì£¼ìš” ì–¸ë¡ ì‚¬ ì²´í¬
    if (item.isGlobal) {
        return MAJOR_GLOBAL_SOURCES.some(source =>
            lowerPublisher.includes(source.toLowerCase()) ||
            lowerLink.includes(source.toLowerCase())
        );
    }

    // 2. êµ­ë‚´ ë‰´ìŠ¤ì¸ ê²½ìš°: êµ­ë‚´ ì£¼ìš” ì–¸ë¡ ì‚¬ ì²´í¬
    // publisher ì •ë³´ê°€ ìžˆìœ¼ë©´ ìš°ì„  í™•ì¸
    if (publisher) {
        if (MAJOR_SOURCES.some(source => lowerPublisher.includes(source.toLowerCase()))) {
            return true;
        }
    }

    // link ë„ë©”ì¸ í™•ì¸
    return MAJOR_SOURCES.some(source => lowerLink.includes(source.toLowerCase()));
}

/**
 * ì‚¬ì „ í•„í„°ë§ ë©”ì¸ í•¨ìˆ˜
 */
export function preFilterNews(newsItems) {
    const passed = [];
    const excluded = {
        adPattern: 0,
        noPriorityKeyword: 0,
        notMajorSource: 0,
        lowQuality: 0
    };

    for (const item of newsItems) {
        const fullText = `${item.title} ${item.description || ''}`;

        // 2. ì£¼ìš” ì–¸ë¡ ì‚¬ ì²´í¬ (êµ­ë‚´/í•´ì™¸ ê³µí†µ í•„ìˆ˜ ì¡°ê±´)
        if (!isMajorSource(item)) {
            excluded.notMajorSource++;
            continue;
        }

        const priorityMatch = hasPriorityKeyword(fullText);
        const hasCompany = item.companies && item.companies.length > 0;

        // 3. ê¸€ë¡œë²Œ ë‰´ìŠ¤ í•„í„°ë§
        if (item.isGlobal) {
            // ì£¼ìš” ì–¸ë¡ ì‚¬ AND (ìš°ì„ ìˆœìœ„ í‚¤ì›Œë“œ OR ê¸°ì—…ëª…)
            if (priorityMatch || hasCompany) {
                passed.push({
                    ...item,
                    priorityKeyword: priorityMatch,
                    isMajorSource: true
                });
            } else {
                excluded.noPriorityKeyword++;
            }
            continue;
        }

        // 4. êµ­ë‚´ ë‰´ìŠ¤ í•„í„°ë§
        // ì£¼ìš” ì–¸ë¡ ì‚¬ AND (ìš°ì„ ìˆœìœ„ í‚¤ì›Œë“œ OR ê¸°ì—…ëª…)
        if (priorityMatch || hasCompany) {
            passed.push({
                ...item,
                priorityKeyword: priorityMatch,
                isMajorSource: true
            });
            continue;
        }

        excluded.noPriorityKeyword++;
    }

    const globalCount = passed.filter(n => n.isGlobal).length;
    const domesticCount = passed.length - globalCount;

    console.log(`ðŸŽ¯ [ì‚¬ì „ í•„í„°] ${newsItems.length}ê°œ â†’ ${passed.length}ê°œ í†µê³¼`);
    console.log(`   â”œâ”€ ê´‘ê³ /ë¬´ê´€ ì œì™¸: ${excluded.adPattern}ê°œ`);
    console.log(`   â”œâ”€ ë¹„ì£¼ë¥˜ ì–¸ë¡ ì‚¬ ì œì™¸: ${excluded.notMajorSource}ê°œ`);
    console.log(`   â”œâ”€ í‚¤ì›Œë“œ/ê¸°ì—…ëª… ë¯¸ë§¤ì¹­ ì œì™¸: ${excluded.noPriorityKeyword}ê°œ`);
    console.log(`   â””â”€ í†µê³¼ (êµ­ë‚´: ${domesticCount}, í•´ì™¸: ${globalCount})`);

    return passed;
}

export default { preFilterNews };
