/**
 * AI ë¶„ì„ ì „ ì‚¬ì „ í•„í„°ë§
 * ì œëª© + ì„¤ëª…ì„ ë¶„ì„í•˜ì—¬ ê´‘ê³ ì„±/ë¬´ê´€ ê¸°ì‚¬ ì œê±°
 * â€» ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ì›Œë“œ ìš”êµ¬ ì œê±° - ì œì™¸ íŒ¨í„´ë§Œ ì²´í¬
 */

// ==================== ì œì™¸ íŒ¨í„´ ====================
const EXCLUDE_PATTERNS = [
    // ê´‘ê³ /í™ë³´
    /\[ê´‘ê³ \]/i, /\[AD\]/i, /\[PR\]/i, /\[í›„ì›\]/i, /\[í˜‘ì°¬\]/i,
    /\[ì œíœ´\]/i, /\[íŒŒíŠ¸ë„ˆ\]/i, /sponsored/i, /advertisement/i,
    /ë¸Œëžœë””ë“œ/, /ë„¤ì´í‹°ë¸Œ ê´‘ê³ /, /ì œíœ´ì½˜í…ì¸ /,

    // ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜/ì‡¼í•‘
    /ì´ë²¤íŠ¸ ì°¸ì—¬/, /ê²½í’ˆ ì‘ëª¨/, /í• ì¸ ì¿ í°/, /ì„¸ì¼ ê¸°ê°„/, /íŠ¹ê°€ í–‰ì‚¬/, /ë¬´ë£Œì²´í—˜/,
    /ì‘ëª¨í•˜/, /ë‹¹ì²¨ìž/, /ì¶”ì²¨/, /ì¦ì •/, /ì‚¬ì€í’ˆ/, /í”„ë¡œëª¨ì…˜ í–‰ì‚¬/,
    /ì‡¼í•‘ëª°/, /ìµœì €ê°€ êµ¬ë§¤/, /í•«ë”œ/, /íƒ€ìž„ì„¸ì¼/,
    /ë¸”ëž™í”„ë¼ì´ë°ì´/, /ì‚¬ì´ë²„ë¨¼ë°ì´/, /ë¹…ì„¸ì¼/,

    // ì—°ì˜ˆ/ì—”í„°í…Œì¸ë¨¼íŠ¸
    /ë“œë¼ë§ˆ ì¶œì—°/, /ì˜ˆëŠ¥ í”„ë¡œê·¸ëž¨/, /ì•„ì´ëŒ ê·¸ë£¹/, /ê±¸ê·¸ë£¹/, /ë³´ì´ê·¸ë£¹/, /ê°€ìˆ˜ í™œë™/,
    /ë°°ìš° ì¶œì—°/, /ì—°ê¸°ìž/, /ì—°ê¸°ë ¥/, /ì—°ê¸° í™œë™/, /ì—°ì˜ˆì¸/, /ì…€ëŸ½/, /ìŠ¤íƒ€ í™”ë³´/, /íŒ¬ë¤/,
    /ì½˜ì„œíŠ¸ ê°œìµœ/, /íŒ¬ë¯¸íŒ…/, /ì•¨ë²” ë°œë§¤/, /ìŒì› ì°¨íŠ¸/, /ì»´ë°± ë¬´ëŒ€/,
    /ë®¤ì§ë¹„ë””ì˜¤/, /ë®¤ë¹„ ê³µê°œ/, /í‹°ì € ì˜ìƒ/, /ê³µê°œë°©ì†¡/,
    /ì˜í™” ê°œë´‰/, /ë°•ìŠ¤ì˜¤í”¼ìŠ¤/, /ê´€ê°ìˆ˜ ëŒíŒŒ/,
    /ì›¹íˆ° ì—°ìž¬/, /ì›¹ì†Œì„¤/, /ë§Œí™”ì±…/,

    // ìŠ¤í¬ì¸ 
    /ì¶•êµ¬ ê²½ê¸°/, /ì•¼êµ¬ ê²½ê¸°/, /ë†êµ¬ ê²½ê¸°/, /ë°°êµ¬ ê²½ê¸°/, /ê³¨í”„ëŒ€íšŒ/, /í…Œë‹ˆìŠ¤ ëŒ€íšŒ/,
    /ì˜¬ë¦¼í”½ ì¶œì „/, /ì›”ë“œì»µ/, /í”„ë¡œë¦¬ê·¸/, /ê²½ê¸° ê²°ê³¼/, /ìŠ¹ë¦¬ë¥¼ ê±°/, /íŒ¨ë°°ë¥¼ ë‹¹/,
    /ìŠ¤í¬ì¸  ì„ ìˆ˜/, /ì•¼êµ¬ ì„ ìˆ˜/, /ì¶•êµ¬ ì„ ìˆ˜/, /ê°ë… ì„ ìž„/, /ì½”ì¹˜ ì˜ìž…/, /ì„ ìˆ˜ ì´ì /, /íŠ¸ë ˆì´ë“œ/,
    /eìŠ¤í¬ì¸  ëŒ€íšŒ/, /ê²Œìž„ëŒ€íšŒ/, /ë¡¤ë“œì»µ/, /LCK ê²°ìŠ¹/,

    // ë¯¸ë””ì–´/í¬í† /ì˜ìƒ
    /í¬í† ë‰´ìŠ¤/, /í™”ë³´ ì´¬ì˜/, /ì›€ì§¤/, /ì§ìº  ì˜ìƒ/, /ì˜ìƒë‰´ìŠ¤/,
    /\[í¬í† \]/, /\[ì˜ìƒ\]/, /\[ì›€ì§¤\]/, /\[í™”ë³´\]/,
    /í¬í†  ê°¤ëŸ¬ë¦¬/, /ë¹„í•˜ì¸ë“œ ì»·/, /ë©”ì´í‚¹ í•„ë¦„/,

    // ë‚ ì”¨/ìš´ì„¸/ë¼ì´í”„
    /ì˜¤ëŠ˜ì˜ ìš´ì„¸/, /ì˜¤ëŠ˜ì˜ ë‚ ì”¨/, /ì£¼ê°„ ë‚ ì”¨/, /ì¼ê¸°ì˜ˆë³´/,
    /ë³„ìžë¦¬ ìš´ì„¸/, /íƒ€ë¡œ ì /, /ì‚¬ì£¼íŒ”ìž/, /ê¶í•© ë³´ê¸°/,
    /ë§›ì§‘ ì¶”ì²œ/, /ë ˆì‹œí”¼ ê³µê°œ/, /ìš”ë¦¬ ë°©ë²•/, /ì¹´íŽ˜ ì¶”ì²œ/, /ë§›ì§‘íƒë°©/,
    /ì—¬í–‰ì§€ ì¶”ì²œ/, /í˜¸í…” ì˜ˆì•½/, /ìˆ™ë°• í• ì¸/, /ê´€ê´‘ ëª…ì†Œ/, /íœ´ê°€ ê³„íš/,
    /íŒ¨ì…˜ ìŠ¤íƒ€ì¼/, /ë·°í‹° íŒ/, /í™”ìž¥í’ˆ ì¶”ì²œ/, /ë©”ì´í¬ì—… íŠœí† ë¦¬ì–¼/, /í—¤ì–´ ìŠ¤íƒ€ì¼/,
    /ë‹¤ì´ì–´íŠ¸ ë°©ë²•/, /í”¼íŠ¸ë‹ˆìŠ¤ íŒ/,

    // ë¶€ë™ì‚°/ê°œì¸ê¸ˆìœµ
    /ì•„íŒŒíŠ¸ ë¶„ì–‘/, /ì²­ì•½ ì¼ì •/, /ì „ì„¸ ì‹œì„¸/, /ì›”ì„¸ ê°€ê²©/, /ë¶€ë™ì‚° ë§¤ë§¤/,
    /ëŒ€ì¶œ ê¸ˆë¦¬ ë¹„êµ/, /ì˜ˆê¸ˆ ê¸ˆë¦¬/, /ì ê¸ˆ ì¶”ì²œ/, /ê°œì¸ ìž¬í…Œí¬/,
    /ì‹ ìš©ì¹´ë“œ ì¶”ì²œ/, /ì¹´ë“œ í˜œíƒ/, /í¬ì¸íŠ¸ ì ë¦½/, /ë§ˆì¼ë¦¬ì§€ ì‚¬ìš©/,

    // ì •ì¹˜/ì‚¬íšŒ ì¼ë°˜
    /êµ­íšŒ ë³¸íšŒì˜/, /ì—¬ë‹¹ ì˜ì›/, /ì•¼ë‹¹ ëŒ€í‘œ/, /ëŒ€í†µë ¹ ë°œì–¸/, /ì´ë¦¬ í›„ë³´/, /ìž¥ê´€í›„ë³´ìž/,
    /ì„ ê±° ìœ ì„¸/, /íˆ¬í‘œ ê²°ê³¼/, /ê³µì²œ ê²½ìŸ/, /ì •ë‹¹ í™œë™/, /ë‹¹ëŒ€í‘œ ì„ ì¶œ/,
    /ì‚¬ê±´ì‚¬ê³  í˜„ìž¥/, /ë²”ì£„ ìˆ˜ì‚¬/, /ê²€ì°° ê¸°ì†Œ/, /ê²½ì°° ì¡°ì‚¬/, /ìž¬íŒ ê²°ê³¼/, /ë²•ì› íŒê²°/,
    /ì‹œìœ„ í˜„ìž¥/, /ì§‘íšŒ ì°¸ê°€/, /ë†ì„± ëŒìž…/, /íŒŒì—… ëŒìž…/,

    // êµìœ¡/ìž…ì‹œ
    /ìˆ˜ëŠ¥ ì‹œí—˜/, /ëŒ€ìž… ì „í˜•/, /ìž…ì‹œ ì„¤ëª…íšŒ/, /í•™ì› ìˆ˜ê°•/, /ê³¼ì™¸ ëª¨ì§‘/,
    /ëŒ€í•™ í•©ê²©/, /ë“±ë¡ê¸ˆ ì¸ìƒ/, /ìž¥í•™ê¸ˆ ìˆ˜í˜œ/,

    // ê±´ê°•/ì˜ë£Œ ì¼ë°˜
    /ê±´ê°• ê´€ë¦¬ íŒ/, /ì§ˆë³‘ ì˜ˆë°©/, /ì¹˜ë£Œ ë°©ë²•/, /ë³‘ì› ì§„ë£Œ/, /ì²˜ë°©ì „/,
    /ë‹¤ì´ì–´íŠ¸ ì‹ë‹¨/, /ì‚´ë¹¼ê¸° ë¹„ë²•/, /ì²´ì¤‘ ê°ëŸ‰/, /ë¹„ë§Œ ê´€ë¦¬/,

    // ê¸°íƒ€ ë¬´ê´€
    /ë‹¨ë… ì¸í„°ë·°/, /ì¹¼ëŸ¼ë‹ˆìŠ¤íŠ¸/, /ì‚¬ì„¤/, /ê¸°ê³ ë¬¸/, /ë…ìžíˆ¬ê³ /,
    /ë¶€ê³  ì†Œì‹/, /ì¡°ì˜/, /ë³„ì„¸ ì†Œì‹/, /íƒ€ê³„í•˜/,
    /ë³µê¶Œ ë‹¹ì²¨/, /ë¡œë˜ ë²ˆí˜¸/, /ë‹¹ì²¨ë²ˆí˜¸ ê³µê°œ/
];

/**
 * ê´‘ê³ ì„±/ë¬´ê´€ íŒ¨í„´ ì²´í¬
 */
function hasExcludePattern(text) {
    return EXCLUDE_PATTERNS.some(pattern => pattern.test(text));
}

/**
 * ì„¤ëª…ë¬¸ í’ˆì§ˆ ì²´í¬ (ìµœì†Œ 30ìž)
 */
function hasQualityDescription(description) {
    if (!description) return true; // ì„¤ëª… ì—†ìœ¼ë©´ í†µê³¼ (ì œëª©ë§Œìœ¼ë¡œ íŒë‹¨)
    return description.length >= 30;
}

/**
 * ì‚¬ì „ í•„í„°ë§ ë©”ì¸ í•¨ìˆ˜
 * â€» ë¹„ì¦ˆë‹ˆìŠ¤ í‚¤ì›Œë“œ ìš”êµ¬ ì—†ì´ ì œì™¸ íŒ¨í„´ë§Œ ì²´í¬
 */
export function preFilterNews(newsItems) {
    const passed = [];
    const excluded = {
        adPattern: 0,
        lowQuality: 0
    };

    for (const item of newsItems) {
        const fullText = `${item.title} ${item.description || ''}`;

        // 1. ê´‘ê³ ì„± íŒ¨í„´ ì²´í¬
        if (hasExcludePattern(fullText)) {
            excluded.adPattern++;
            continue;
        }

        // 2. ê¸€ë¡œë²Œ ë‰´ìŠ¤ëŠ” ë°”ë¡œ í†µê³¼
        if (item.isGlobal) {
            passed.push(item);
            continue;
        }

        // 3. ì„¤ëª…ë¬¸ í’ˆì§ˆ ì²´í¬ (ë„ˆë¬´ ì§§ìœ¼ë©´ ì œì™¸)
        if (item.description && !hasQualityDescription(item.description)) {
            excluded.lowQuality++;
            continue;
        }

        passed.push(item);
    }

    const globalCount = passed.filter(n => n.isGlobal).length;
    const domesticCount = passed.length - globalCount;

    console.log(`ðŸŽ¯ [ì‚¬ì „ í•„í„°] ${newsItems.length}ê°œ â†’ ${passed.length}ê°œ í†µê³¼`);
    console.log(`   â”œâ”€ ê´‘ê³ /ë¬´ê´€ ì œì™¸: ${excluded.adPattern}ê°œ`);
    console.log(`   â”œâ”€ ì €í’ˆì§ˆ: ${excluded.lowQuality}ê°œ`);
    console.log(`   â””â”€ í†µê³¼ (êµ­ë‚´: ${domesticCount}, í•´ì™¸: ${globalCount})`);

    return passed;
}

export default { preFilterNews };
